<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="repo" content="https://github.com/gvwilson/sd4ds">
  <meta name="build_date" content="2023-06-09">
  <meta name="template" content="default">
  <meta name="major" content="Chapter 23">
  <meta name="has_slides" content="true">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="../mccole.css">
  <link rel="stylesheet" href="../tango.css">
  <script defer data-domain="third-bit.com" src="https://plausible.io/js/plausible.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']]
      }
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script defer src="../mccole.js"></script>
  <title>Software Design for Data Scientists: A Text Viewer</title>
</head>

  <body>
    <div class="row">
      <div class="sidebar">
        <p>
  
  <img src="../logo.svg" alt="site logo" class="logo" />
  <a href="../">Software Design for Data Scientists</a>
  
</p>
<ol class="toc-chapter">
  
  <li>
    <a href="../intro/">
      Introduction
    </a>
  </li>
  
  <li>
    <a href="../dup/">
      Finding Duplicate Files
    </a>
  </li>
  
  <li>
    <a href="../glob/">
      Matching Patterns
    </a>
  </li>
  
  <li>
    <a href="../parse/">
      Parsing Text
    </a>
  </li>
  
  <li>
    <a href="../test/">
      A Test Runner
    </a>
  </li>
  
  <li>
    <a href="../interp/">
      An Interpreter
    </a>
  </li>
  
  <li>
    <a href="../func/">
      Functions and Closures
    </a>
  </li>
  
  <li>
    <a href="../mock/">
      Mock Objects
    </a>
  </li>
  
  <li>
    <a href="../archive/">
      A File Archiver
    </a>
  </li>
  
  <li>
    <a href="../oop/">
      Objects and Classes
    </a>
  </li>
  
  <li>
    <a href="../check/">
      An HTML Validator
    </a>
  </li>
  
  <li>
    <a href="../template/">
      A Template Expander
    </a>
  </li>
  
  <li>
    <a href="../lint/">
      A Code Linter
    </a>
  </li>
  
  <li>
    <a href="../layout/">
      Page Layout
    </a>
  </li>
  
  <li>
    <a href="../perf/">
      Performance Profiling
    </a>
  </li>
  
  <li>
    <a href="../persist/">
      Object Persistence
    </a>
  </li>
  
  <li>
    <a href="../binary/">
      Binary Data
    </a>
  </li>
  
  <li>
    <a href="../db/">
      A Database
    </a>
  </li>
  
  <li>
    <a href="../build/">
      A Build Manager
    </a>
  </li>
  
  <li>
    <a href="../pack/">
      A Package Manager
    </a>
  </li>
  
  <li>
    <a href="../ftp/">
      Transferring Files
    </a>
  </li>
  
  <li>
    <a href="../http/">
      Serving Web Pages
    </a>
  </li>
  
  <li>
    <a href="../viewer/">
      <strong>A Text Viewer</strong>
    </a>
  </li>
  
  <li>
    <a href="../undo/">
      Undo and Redo
    </a>
  </li>
  
  <li>
    <a href="../vm/">
      A Virtual Machine
    </a>
  </li>
  
  <li>
    <a href="../debugger/">
      A Debugger
    </a>
  </li>
  
  <li>
    <a href="../finale/">
      Conclusion
    </a>
  </li>
  
</ol>
<ol class="toc-appendix">
  
  <li>
    <a href="../bib/">
      Bibliography
    </a>
  </li>
  
  <li>
    <a href="../syllabus/">
      Syllabus
    </a>
  </li>
  
  <li>
    <a href="../slides/">
      Slides
    </a>
  </li>
  
  <li>
    <a href="../license/">
      License
    </a>
  </li>
  
  <li>
    <a href="../conduct/">
      Code of Conduct
    </a>
  </li>
  
  <li>
    <a href="../contrib/">
      Contributing
    </a>
  </li>
  
  <li>
    <a href="../glossary/">
      Glossary
    </a>
  </li>
  
  <li>
    <a href="../credits/">
      Credits
    </a>
  </li>
  
  <li>
    <a href="../contents/">
      Index
    </a>
  </li>
  
</ol>

<p><a href="../sd4ds-examples.zip" type="application/zip">download examples</a></p>


      </div>
      <div id="printable" class="contents bordered">
        <main>
          
  <h1>Chapter 23: A Text Viewer</h1>


          
<div class="draft">
  <p>DRAFT</p>
</div>
<div class="center">
  <p>
    <em>Please use section heading links to submit feedback.</em>
  </p>
</div>


          
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


          

          <div class="page-toc"></div>
          <ul>
<li>
<p><code>first_curses.py</code>: run a program with a screen</p>
<ul>
<li>Does nothing with keys</li>
<li>Stop with Ctrl-C</li>
<li>No way to see what it&rsquo;s doing (can&rsquo;t print)</li>
</ul>
</li>
<li>
<p><code>logging_curses.py</code>: create a log file</p>
<ul>
<li>Use <code>lambda</code> to create a function with the signature needed by <code>curses.wrapper</code></li>
<li>Print representation of characters to file (so that <code>\n</code> shows up)</li>
<li>Exit cleanly</li>
</ul>
</li>
<li>
<p><code>show_lines.py</code>: show lines in location</p>
<ul>
<li>Screen coordinates put (0, 0) in the upper left</li>
<li>Run <code>show_lines.py</code> with 1000 lines (anything larger than screen)<ul>
<li><code>_curses.error: addwstr() returned ERR</code> because trying to draw off bottom of screen</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>use_window.py</code>: fix problem with <code>show_lines.py</code></p>
<ul>
<li>Create a <code>Window</code> class that knows how big the window is<ul>
<li>Can&rsquo;t create this and then pass it in to <code>main</code> because <code>curses.wrapper</code> creates <code>stdscr</code></li>
</ul>
</li>
<li>Redraw all the lines each time: it&rsquo;s a <em>view</em> class</li>
</ul>
</li>
<li>
<p><code>size_window.py</code>: allow user to specify size of window</p>
<ul>
<li>Helps with testing</li>
</ul>
</li>
<li>
<p><code>d2.py</code>: use a tuple and constants <code>ROW</code> and <code>COL</code></p>
<ul>
<li>Should create a class, but that&rsquo;s more effort than it&rsquo;s worth right now</li>
</ul>
</li>
<li>
<p><code>move_cursor.py</code>: create and move a cursor</p>
<ul>
<li><code>Cursor.pos</code> returns (y, x) position as tuple (so that caller can&rsquo;t modify internals)</li>
<li>Spread that into <code>stdscr.move</code></li>
<li>But can move right or below text</li>
<li>And blow up when moving off left of screen or off top</li>
<li><code>_curses.error: wmove() returned ERR</code></li>
</ul>
</li>
<li>
<p><code>main_app.py</code>: create an application object with a <code>__call__</code> method (required by <code>curses.wrapper</code>)</p>
<ul>
<li>Delayed instantiation of <code>Window</code></li>
</ul>
</li>
<li>
<p><code>dispatch_keys.py</code>: find and call key handlers dynamically</p>
<ul>
<li>Use a member variable <code>self._running</code> and have <code>_handle_q</code> handle that
    so that other methods don&rsquo;t have to return anything</li>
<li>But now can only quit with lower-case &lsquo;q&rsquo; (and will want to insert that character)</li>
<li>So add <code>TRANSLATE</code> to turn things like Ctrl-X into strings <code>CONTROL_X</code></li>
</ul>
</li>
<li>
<p><code>buffer_class.py</code>: create a class to manage the buffer</p>
</li>
<li>
<p><code>clip_cursor.py</code>: make sure cursor cannot move outside of lines</p>
<ul>
<li>But go to a long line and then move up to a shorter one</li>
<li><code>clip_fixed.py</code></li>
</ul>
</li>
<li>
<p>Can still move below the window because cursor is in buffer space not window space</p>
</li>
<li>What if the buffer is bigger than the window?<ul>
<li>Need a <em>viewport</em> to keep track of the portion of the buffer that is currently visible</li>
<li>We&rsquo;ll do vertical and leave horizontal for exercises</li>
</ul>
</li>
<li><code>viewport.py</code><ul>
<li>Add <code>transform</code> to transform cursor coordinates into screen coordinates</li>
<li>Keep track of the top visible line</li>
<li>Add a <code>bottom</code> method for convenience</li>
<li>Move the <code>_top</code> marker up or down as needed</li>
<li>Cursor needs to clip left and right as well as up and down</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>main</th>
<th>window</th>
<th>cursor</th>
<th>buffer</th>
<th>app</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>first_curses.py</code></td>
<td><code>main</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>logging_curses.py</code></td>
<td><code>main</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>show_lines.py</code></td>
<td><code>main</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>use_window.py</code></td>
<td><code>main</code></td>
<td><code>Window</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>size_window.py</code></td>
<td><code>main</code></td>
<td><code>Window</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>d2.py</code></td>
<td><code>main</code></td>
<td><code>Window</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>move_cursor.py</code></td>
<td><code>main</code></td>
<td></td>
<td><code>Cursor</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>main_app.py</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>MainApp</code></td>
</tr>
<tr>
<td><code>dispatch_app.py</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>DispatchApp</code></td>
</tr>
<tr>
<td><code>buffer_class.py</code></td>
<td></td>
<td></td>
<td></td>
<td><code>Buffer</code></td>
<td><code>BufferApp</code></td>
</tr>
<tr>
<td><code>clip_cursor.py</code></td>
<td></td>
<td></td>
<td><code>ClipCursor</code></td>
<td><code>ClipBuffer</code></td>
<td><code>ClipApp</code></td>
</tr>
<tr>
<td><code>clip_fixed.py</code></td>
<td></td>
<td></td>
<td><code>ClipCursorFixed</code></td>
<td></td>
<td><code>ClipAppFixed</code></td>
</tr>
<tr>
<td><code>viewport.py</code></td>
<td></td>
<td></td>
<td><code>ViewportCursor</code></td>
<td><code>ViewportBuffer</code></td>
<td><code>ViewportApp</code></td>
</tr>
</tbody>
</table>
        </main>
      </div>
    </div>
  </body>
</html>
