<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="../mccole.css">
  <link rel="stylesheet" href="../tango.css">
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']]
      }
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <title>Software Design in Python: A Pipeline Runner</title>
</head>

  <body>
    <div class="row">
      <div class="column">
        <p>
  <img src="../logo.svg" alt="site logo" width="10%" />
  <a href="../">Software Design in Python</a>
</p>
<ol class="toc-chapter">
  
  <li>
    <a href="../introduction/">
      Introduction
    </a>
  </li>
  
  <li>
    <a href="../tester/">
      A Testing Framework
    </a>
  </li>
  
  <li>
    <a href="../backup/">
      Versioned File Backups
    </a>
  </li>
  
  <li>
    <a href="../interpreter/">
      An Interpreter
    </a>
  </li>
  
  <li>
    <a href="../dataframe/">
      A Dataframe
    </a>
  </li>
  
  <li class="todo">
    <a href="../pipeline/">
      <strong>A Pipeline Runner</strong>
    </a>
  </li>
  
  <li>
    <a href="../builder/">
      A Build Manager
    </a>
  </li>
  
  <li>
    <a href="../matching/">
      Matching Regular Expressions
    </a>
  </li>
  
  <li>
    <a href="../parser/">
      Parsing Regular Expressions
    </a>
  </li>
  
  <li>
    <a href="../server/">
      A Web Server
    </a>
  </li>
  
  <li class="todo">
    <a href="../filecache/">
      A File Cache
    </a>
  </li>
  
  <li class="todo">
    <a href="../database/">
      A Database
    </a>
  </li>
  
  <li>
    <a href="../persistence/">
      Object Persistence
    </a>
  </li>
  
  <li>
    <a href="../binary/">
      Binary Storage
    </a>
  </li>
  
  <li>
    <a href="../templating/">
      HTML Templating
    </a>
  </li>
  
  <li class="todo">
    <a href="../packman/">
      A Package Manager
    </a>
  </li>
  
  <li>
    <a href="../layout/">
      Page Layout
    </a>
  </li>
  
  <li class="todo">
    <a href="../linter/">
      A Style Checker
    </a>
  </li>
  
  <li class="todo">
    <a href="../docgen/">
      A Documentation Generator
    </a>
  </li>
  
  <li>
    <a href="../codegen/">
      A Code Generator
    </a>
  </li>
  
  <li>
    <a href="../vm/">
      A Virtual Machine and Assembler
    </a>
  </li>
  
  <li class="todo">
    <a href="../debugger/">
      Debugger
    </a>
  </li>
  
  <li>
    <a href="../conclusion/">
      Conclusion
    </a>
  </li>
  
</ol>
<ol class="toc-appendix">
  
  <li>
    <a href="../bibliography/">
      Bibliography
    </a>
  </li>
  
  <li>
    <a href="../syllabus/">
      Syllabus
    </a>
  </li>
  
  <li>
    <a href="../license/">
      License
    </a>
  </li>
  
  <li>
    <a href="../conduct/">
      Code of Conduct
    </a>
  </li>
  
  <li>
    <a href="../contributing/">
      Contributing
    </a>
  </li>
  
  <li>
    <a href="../glossary/">
      Glossary
    </a>
  </li>
  
  <li>
    <a href="../links/">
      Links
    </a>
  </li>
  
  <li>
    <a href="../credits/">
      Credits
    </a>
  </li>
  
  <li>
    <a href="../contents/">
      Index
    </a>
  </li>
  
</ol>

      </div>
      <div class="column bordered todo">
        <main>
	  
  <h1>Chapter 6: A Pipeline Runner</h1>


          
  

  

  

  

  
  <ul class="syllabus">
  
  <li markdown="1">FIXME</li>
  
  </ul>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


	  
  

  

  
  <p class="definitions">
    Terms defined:
    <a class="gl-ref" href="../glossary/#decorator" markdown="1">decorator</a>, <a class="gl-ref" href="../glossary/#overlay_configuration" markdown="1">overlay configuration</a>, <a class="gl-ref" href="../glossary/#provenance" markdown="1">provenance</a>
  </p>
  

  

  

  

  

  

  

  

  

  

  


          <p>Data science is all the rage these days.
No one can agree on exactly what it is,
but everyone's definition includes processing large datasets.
Data scientists usually do this with pipelines
that apply several operations to the data one after another.
In order to automate, share, and check their work,
they want the processing steps to be reproducible:
someone else,
somewhere else,
ought to be able to re-run the exact same steps
without consulting the original author.</p>
<p>This chapter builds a small toolkit for running pipelines
that is easy to extend
and that automatically records the <a class="gl-ref" href="../glossary/#provenance" markdown="1">provenance</a>
of each output.
Since this isn't a book about data science,
we will use common text processing operations in our examples.
Please feel free to replace them with complicated mathematics.</p>
<h2 id="pipeline-list">Section 6.1: Pipelines as Lists</h2>
<p>Suppose we have five functions:</p>
<ul>
<li><code>read(filename)</code> reads a CSV file and returns a list of rows,
   each of which is a list of values.</li>
<li><code>head(data, num)</code> returns the first <code>num</code> rows of a dataset.</li>
<li><code>tail(data, num)</code> returns the last <code>num</code> rows.</li>
<li><code>left(data, num)</code> and <code>right(data, num)</code> return
    the first and last <code>num</code> columns of the data respectively.</li>
</ul>
<p>We can combine these functions in two ways.
The first uses nested function calls:</p>
<div class="highlight"><pre><span></span><code><span class="n">left</span><span class="p">(</span><span class="n">tail</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;sample_data.csv&quot;</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p class="continue">but this quickly becomes hard to read.
(Quick, is the 10 being passed to <code>head</code> or to <code>tail</code>?)
The second uses temporary variables:</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s2">&quot;sample_data.csv&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tail</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">left</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p class="continue">which is easier to read when there are more than a handful of stages,
but can be error-prone.
(Did you notice that the code above is passing <code>frame</code> to <code>tail</code>
instead of <code>data</code>?)</p>
<p>But a function is just another kind of object,
so we can put it in a list along with its arguments like this:</p>
<pre><code>&lt;div class="code-sample lang-py" title="direct_list.py" markdown="1"&gt;
```py
from functions import *
</code></pre>
<p>pipeline = [
    [read, "sample_data.csv"],
    [head, 10],
    [tail, 5],
    [left, 2]
]</p>
<p>for (i, step) in enumerate(pipeline):
    func, params = step[0], step[1:]
    if i == 0:
        data = func(<em>params)
    else:
        data = func(data, </em>params)</p>
<pre><code>```
</code></pre>
<h2 id="pipeline-config">Section 6.2: Configuration</h2>
<p>Every function remembers the name it was given when it was defined:</p>
<pre><code>&lt;div class="code-sample lang-py" title="func_name.py" markdown="1"&gt;
```py
def proof(x, y):
pass
</code></pre>
<p>print(proof.<strong>name</strong>)
    ```</p>
        </main>
      </div>
    </div>
  </body>
</html>
