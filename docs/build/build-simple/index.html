<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" type="image/x-icon" href="../../favicon.ico">
  <link rel="stylesheet" href="../../mccole.css">
  <link rel="stylesheet" href="../../tango.css">
  <script defer data-domain="third-bit.com" src="https://plausible.io/js/plausible.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']]
      }
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script defer src="../../mccole.js"></script>
  <title>Software Design for Data Scientists</title>
</head>

  <body>
    <div class="row">
      <div class="sidebar">
        <p>
  
  <img src="../../logo.svg" alt="site logo" class="logo" />
  <a href="../../">Software Design for Data Scientists</a>
  
</p>
<ol class="toc-chapter">
  
  <li>
    <a href="../../intro/">
      Introduction
    </a>
  </li>
  
  <li>
    <a href="../../dup/">
      Finding Duplicate Files
    </a>
  </li>
  
  <li>
    <a href="../../glob/">
      Matching Patterns
    </a>
  </li>
  
  <li>
    <a href="../../parse/">
      Parsing Text
    </a>
  </li>
  
  <li>
    <a href="../../test/">
      A Testing Framework
    </a>
  </li>
  
  <li>
    <a href="../../mock/">
      Mock Objects
    </a>
  </li>
  
  <li>
    <a href="../../archive/">
      Archiving Files
    </a>
  </li>
  
  <li>
    <a href="../../oop/">
      Classes and Objects
    </a>
  </li>
  
  <li>
    <a href="../../meta/">
      Meta-Programming
    </a>
  </li>
  
  <li>
    <a href="../../check/">
      Checking HTML
    </a>
  </li>
  
  <li>
    <a href="../../interp/">
      An Interpreter
    </a>
  </li>
  
  <li>
    <a href="../../func/">
      Function Definition and Call
    </a>
  </li>
  
  <li>
    <a href="../../template/">
      Template Expansion
    </a>
  </li>
  
  <li>
    <a href="../../lint/">
      A Style Checker
    </a>
  </li>
  
  <li>
    <a href="../../perf/">
      Performance Profiling
    </a>
  </li>
  
  <li>
    <a href="../../df/">
      Dataframes
    </a>
  </li>
  
  <li>
    <a href="../../plot/">
      Plotting Graphs
    </a>
  </li>
  
  <li>
    <a href="../../persist/">
      Object Persistence
    </a>
  </li>
  
  <li>
    <a href="../../binary/">
      Binary Data
    </a>
  </li>
  
  <li>
    <a href="../../db/">
      A Database
    </a>
  </li>
  
  <li>
    <a href="../../build/">
      A Build Manager
    </a>
  </li>
  
  <li>
    <a href="../../pipe/">
      A Pipeline Runner
    </a>
  </li>
  
  <li>
    <a href="../../cache/">
      A File Cache
    </a>
  </li>
  
  <li>
    <a href="../../pack/">
      A Package Manager
    </a>
  </li>
  
  <li>
    <a href="../../install/">
      An Installer
    </a>
  </li>
  
  <li>
    <a href="../../server/">
      A Web Server
    </a>
  </li>
  
  <li>
    <a href="../../ssg/">
      A Static Site Generator
    </a>
  </li>
  
  <li>
    <a href="../../finale/">
      Conclusion
    </a>
  </li>
  
</ol>
<ol class="toc-appendix">
  
  <li>
    <a href="../../bib/">
      Bibliography
    </a>
  </li>
  
  <li>
    <a href="../../syllabus/">
      Syllabus
    </a>
  </li>
  
  <li>
    <a href="../../slides/">
      Slides
    </a>
  </li>
  
  <li>
    <a href="../../license/">
      License
    </a>
  </li>
  
  <li>
    <a href="../../conduct/">
      Code of Conduct
    </a>
  </li>
  
  <li>
    <a href="../../contrib/">
      Contributing
    </a>
  </li>
  
  <li>
    <a href="../../glossary/">
      Glossary
    </a>
  </li>
  
  <li>
    <a href="../../credits/">
      Credits
    </a>
  </li>
  
  <li>
    <a href="../../contents/">
      Index
    </a>
  </li>
  
</ol>

<p><a href="../../sd4ds-examples.zip" type="application/zip">download examples</a></p>


      </div>
      <div id="printable" class="contents bordered">
        <main>
          
  <h1>Software Design for Data Scientists</h1>
  <p><em>a tool-based introduction</em></p>


          
            
<div class="draft">
  <p>DRAFT</p>
</div>


            

            

            <div class="page-toc"></div>
            import json
import sys


# [main]
class BuildBase:
    def build(self, config_file):
        config = self._configure(config_file)
        ordered = self._topo_sort(config)
        for node in ordered:
            self._refresh(config, node)
# [/main]

    # [config]
    def _configure(self, config_file):
        with open(config_file, "r") as reader:
            config = json.load(reader)
            known = set(config.keys())
            return {
                n: self._check(n, d, known)
                for n, d in config.items()
            }

    def _check(self, name, details, known):
        assert "rule" in details, f"Missing rule for {name}"
        assert "depends" in details, f"Missing depends for {name}"
        depends = set(details["depends"])
        assert depends.issubset(known), f"Unknown depends for {name}"
        return {"rule": details["rule"], "depends": depends}
    # [/config]

    def _topo_sort(self, config):
        graph = {n: config[n]["depends"] for n in config}
        result = []
        while graph:
            available = {n for n in graph if not graph[n]}
            assert (
                available
            ), f"Dependency graph is circular {graphs.keys()}"
            result.extend(available)
            graph = {
                n: graph[n] - available
                for n in graph
                if n not in available
            }
        return result

    def _refresh(self, config, node):
        assert node in config, f"Unknown node {node}"
        print(config[node]["rule"])


if __name__ == "__main__":
    builder = BuildBase()
    builder.build(sys.argv[1])

          
        </main>
      </div>
    </div>
  </body>
</html>
