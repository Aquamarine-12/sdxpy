<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="../mccole.css">
  <link rel="stylesheet" href="../tango.css">
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']]
      }
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <title>Software Design in Python: A Dataframe</title>
</head>

  <body>
    <div class="row">
      <div class="column">
        <p>
  <img src="../logo.svg" alt="site logo" width="10%" />
  <a href="../">Software Design in Python</a>
</p>
<ol class="toc-chapter">
  
  <li>
    <a href="../introduction/">
      Introduction
    </a>
  </li>
  
  <li>
    <a href="../tester/">
      A Testing Framework
    </a>
  </li>
  
  <li>
    <a href="../backup/">
      Versioned File Backups
    </a>
  </li>
  
  <li>
    <a href="../interpreter/">
      An Interpreter
    </a>
  </li>
  
  <li>
    <a href="../dataframe/">
      <strong>A Dataframe</strong>
    </a>
  </li>
  
  <li class="todo">
    <a href="../pipeline/">
      A Pipeline Runner
    </a>
  </li>
  
  <li>
    <a href="../builder/">
      A Build Manager
    </a>
  </li>
  
  <li>
    <a href="../matching/">
      Matching Regular Expressions
    </a>
  </li>
  
  <li>
    <a href="../parser/">
      Parsing Regular Expressions
    </a>
  </li>
  
  <li>
    <a href="../server/">
      A Web Server
    </a>
  </li>
  
  <li class="todo">
    <a href="../filecache/">
      A File Cache
    </a>
  </li>
  
  <li class="todo">
    <a href="../database/">
      A Database
    </a>
  </li>
  
  <li>
    <a href="../persistence/">
      Object Persistence
    </a>
  </li>
  
  <li>
    <a href="../binary/">
      Binary Storage
    </a>
  </li>
  
  <li>
    <a href="../templating/">
      HTML Templating
    </a>
  </li>
  
  <li class="todo">
    <a href="../packman/">
      A Package Manager
    </a>
  </li>
  
  <li>
    <a href="../layout/">
      Page Layout
    </a>
  </li>
  
  <li class="todo">
    <a href="../linter/">
      A Style Checker
    </a>
  </li>
  
  <li class="todo">
    <a href="../docgen/">
      A Documentation Generator
    </a>
  </li>
  
  <li>
    <a href="../codegen/">
      A Code Generator
    </a>
  </li>
  
  <li>
    <a href="../vm/">
      A Virtual Machine and Assembler
    </a>
  </li>
  
  <li class="todo">
    <a href="../debugger/">
      Debugger
    </a>
  </li>
  
  <li>
    <a href="../conclusion/">
      Conclusion
    </a>
  </li>
  
</ol>
<ol class="toc-appendix">
  
  <li>
    <a href="../bibliography/">
      Bibliography
    </a>
  </li>
  
  <li>
    <a href="../syllabus/">
      Syllabus
    </a>
  </li>
  
  <li>
    <a href="../license/">
      License
    </a>
  </li>
  
  <li>
    <a href="../conduct/">
      Code of Conduct
    </a>
  </li>
  
  <li>
    <a href="../contributing/">
      Contributing
    </a>
  </li>
  
  <li>
    <a href="../glossary/">
      Glossary
    </a>
  </li>
  
  <li>
    <a href="../links/">
      Links
    </a>
  </li>
  
  <li>
    <a href="../credits/">
      Credits
    </a>
  </li>
  
  <li>
    <a href="../contents/">
      Index
    </a>
  </li>
  
</ol>

      </div>
      <div class="column bordered">
        <main>
	  
  <h1>Chapter 5: A Dataframe</h1>


          
  

  

  

  
  <ul class="syllabus">
  
  <li markdown="1">Create abstract base classes to specify interfaces.</li>
  
  <li markdown="1">Store two-dimensional data as rows or as columns.</li>
  
  <li markdown="1">Use reflection to match data to function parameters.</li>
  
  <li markdown="1">Measure performance to evaluate engineering tradeoffs.</li>
  
  </ul>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


	  
  

  

  

  
  <p class="definitions">
    Terms defined:
    <a class="gl-ref" href="../glossary/#abstract_class" markdown="1">abstract class</a>, <a class="gl-ref" href="../glossary/#benchmark" markdown="1">benchmark</a>, <a class="gl-ref" href="../glossary/#column_wise" markdown="1">column-wise storage</a>, <a class="gl-ref" href="../glossary/#concrete_class" markdown="1">concrete class</a>, <a class="gl-ref" href="../glossary/#immutable" markdown="1">immutable</a>, <a class="gl-ref" href="../glossary/#index_database" markdown="1">index (a database)</a>, <a class="gl-ref" href="../glossary/#join" markdown="1">join (tables)</a>, <a class="gl-ref" href="../glossary/#row_wise" markdown="1">row-wise storage</a>
  </p>
  

  

  

  

  

  

  

  

  

  


          <p>Whether your tool of choice is Python, R, SQL, or Excel,
you're almost certainly doing data science on tables
with named columns that have the same type of value in every row.
To explore how they work,
we build two implementations of dataframes in Python:
one that stores values in columns,
the other that stores them in rows.
And to explain how to choose between them,
we measure their performance.</p>
<h2 id="dataframe-cols">Section 5.1: Storing Columns</h2>
<p>We start by creating an <a class="gl-ref" href="../glossary/#abstract_class" markdown="1">abstract class</a>
that defines the methods our two dataframe classes will support.
This class (unimaginatively called <code>DF</code>)
requires <a class="gl-ref" href="../glossary/#concrete_class" markdown="1">concrete classes</a> to implement eight methods:</p>
<ul>
<li><code>ncol</code>: report the number of columns.</li>
<li><code>nrow</code>: report the number of rows.</li>
<li><code>cols</code>: return the set of column names.</li>
<li><code>eq</code>: check whether this dataframe is equal to another.</li>
<li><code>get</code>: get a scalar value from a specified column and row.</li>
<li><code>set</code>: set the scalar value in a specified column and row.</li>
<li><code>select</code>: create a new dataframe containing some or all of the original's columns.</li>
<li>
<p><code>filter</code>: create a new dataframe containing some or all of the original's rows.</p>
<p><div class="code-sample lang-py" title="df_base.py" markdown="1">
```py
from abc import ABC</p>
</li>
</ul>
<p>class DF(ABC):
    """Dataframe interface."""</p>
<pre><code>def ncol(self):
    """Report the number of columns."""

def nrow(self):
    """Report the number of rows."""

def cols(self):
    """Return the set of column names."""

def eq(self, other):
    """Check equality of two dataframes."""

def get(self, col, row):
    """Get a scalar value."""

def select(self, *names):
    """Select a subset of columns."""

def filter(self, func):
    """Select a subset of rows."""
```
</code></pre>
<div class="callout">
<h3>Docstrings are enough</h3>
<p><span class="FIXME">FIXME</span></p>
</div>
<p>We then derive a class <code>DfCol</code> that uses <a class="gl-ref" href="../glossary/#column_wise" markdown="1">column-wise</a> storage.
Each column is stored as a list of values,
all of which are of the same type.
The dataframe is a dictionary of such lists,
all of which have the same length:</p>
<pre><code>&lt;div class="code-sample lang-py" title="df_col.py" markdown="1"&gt;
```py
from df_base import DF
</code></pre>
<p>class DfCol(DF):
    """Column-wise dataframe."""</p>
<pre><code>def __init__(self, **kwargs):
    """Initialize from `name=[values]`."""
    assert len(kwargs) &gt; 0
    assert all_eq(len(kwargs[k]) for k in kwargs)
    for k in kwargs:
        assert all_eq(type(v) for v in kwargs[k])
    self._data = kwargs
```
</code></pre>
<p>Some methods are almost trivial to implement on top of this storage mechanism;
others are more difficult.
Three of the easy ones return the number of rows and columns
and the names of the columns:</p>
        </main>
      </div>
    </div>
  </body>
</html>
